<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم الإدارة - المنصة الأكاديمية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        purple: {
                            50: '#faf5ff',
                            100: '#f3e8ff',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }
        .popup-overlay { backdrop-filter: blur(5px); }
        .tab-active { border-bottom: 3px solid #8b5cf6; color: #8b5cf6; }
        .card-hover:hover { transform: translateY(-2px); transition: all 0.3s ease; }
        .notification-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .priority-normal { border-right: 4px solid #10b981; }
        .priority-important { border-right: 4px solid #f59e0b; }
        .priority-urgent { border-right: 4px solid #ef4444; }
        .sidebar { transition: transform 0.3s ease; }
        .sidebar-collapsed { transform: translateX(100%); }
        @media (max-width: 768px) {
            .sidebar { position: fixed; top: 0; right: 0; height: 100vh; z-index: 50; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800">
        <div class="max-w-md w-full mx-4">
            <!-- Logo Section -->
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg p-2">
                    <img src="https://drive.google.com/uc?export=view&id=1z3uZjYrJyUJW20pFuxB18rclWWZVtEAP" 
                         alt="شعار المنصة الأكاديمية" 
                         class="w-full h-full object-contain rounded-full"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <span class="text-purple-600 font-bold text-3xl hidden">🎓</span>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">المنصة الأكاديمية</h1>
                <p class="text-purple-200">لجنة الطب البيطري</p>
            </div>

            <!-- Login Form -->
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">تسجيل الدخول</h2>
                    <p class="text-gray-600">أدخل بياناتك للوصول إلى المنصة</p>
                </div>

                <form id="loginForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">اسم المستخدم</label>
                        <div class="relative">
                            <input type="text" id="username" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 pr-12"
                                   placeholder="أدخل اسم المستخدم">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <span class="text-gray-400 text-lg">👤</span>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">كلمة المرور</label>
                        <div class="relative">
                            <input type="password" id="password" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 pr-12"
                                   placeholder="أدخل كلمة المرور">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <span class="text-gray-400 text-lg">🔒</span>
                            </div>
                            <button type="button" id="togglePassword" class="absolute inset-y-0 left-0 pl-3 flex items-center">
                                <span class="text-gray-400 text-sm hover:text-gray-600 cursor-pointer">👁️</span>
                            </button>
                        </div>
                    </div>

                    <div class="flex items-center justify-between">
                        <label class="flex items-center">
                            <input type="checkbox" id="rememberMe" class="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded">
                            <span class="mr-2 text-sm text-gray-600">تذكرني</span>
                        </label>
                        <button type="button" class="text-sm text-purple-600 hover:text-purple-500">
                            نسيت كلمة المرور؟
                        </button>
                    </div>

                    <button type="submit" id="loginBtn"
                            class="w-full bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 focus:ring-4 focus:ring-purple-200 transition-all duration-200 font-medium">
                        <span id="loginBtnText">🔑 تسجيل الدخول</span>
                        <span id="loginSpinner" class="hidden">⏳ جاري التحقق...</span>
                    </button>
                </form>

                <!-- Error Message -->
                <div id="loginError" class="hidden mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm text-center">
                    <span class="text-lg">❌</span>
                    <span id="loginErrorText">اسم المستخدم أو كلمة المرور غير صحيحة</span>
                </div>


            </div>

            <!-- Footer -->
            <div class="text-center mt-8 text-purple-200 text-sm">
                <p>© 2024 المنصة الأكاديمية - جميع الحقوق محفوظة</p>
            </div>
        </div>
    </div>

    <!-- Main Dashboard (Hidden initially) -->
    <div id="dashboardPage" class="hidden">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-purple-100 sticky top-0 z-40">
        <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <!-- Logo -->
                    <div class="relative">
                        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-sm border border-purple-100 p-1">
                            <img src="https://drive.google.com/uc?export=view&id=1z3uZjYrJyUJW20pFuxB18rclWWZVtEAP" 
                                 alt="شعار المنصة" 
                                 class="w-full h-full object-contain rounded-full"
                                 onerror="this.style.display='none'; this.parentElement.classList.add('bg-purple-600'); this.nextElementSibling.style.display='flex';">
                            <span class="text-white font-bold text-xl hidden">🎓</span>
                        </div>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-gray-900">لوحة تحكم الإدارة</h1>
                        <p class="text-xs text-purple-600">المنصة الأكاديمية - لجنة الطب البيطري</p>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="hidden lg:flex items-center space-x-6 space-x-reverse">
                    <div class="text-center">
                        <div class="text-lg font-bold text-purple-600" id="totalUsers">245</div>
                        <div class="text-xs text-gray-500">إجمالي المستخدمين</div>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold text-green-600" id="activeToday">42</div>
                        <div class="text-xs text-gray-500">نشط اليوم</div>
                    </div>
                    <div class="text-center">
                        <div class="text-lg font-bold text-blue-600" id="totalPosts">128</div>
                        <div class="text-xs text-gray-500">المنشورات</div>
                    </div>
                </div>

                <!-- Admin Menu -->
                <div class="flex items-center space-x-4 space-x-reverse">
                    <!-- Back Button -->
                    <button id="backBtn" class="hidden p-2 text-gray-600 hover:text-purple-600 transition-colors" title="العودة للصفحة السابقة">
                        <span class="text-xl">↩️</span>
                    </button>

                    <!-- Notifications -->
                    <div class="relative">
                        <button id="adminNotificationBtn" class="p-2 text-gray-600 hover:text-purple-600 relative">
                            <span class="text-xl">🔔</span>
                            <span id="adminNotificationBadge" class="notification-dot absolute -top-1 -left-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">8</span>
                        </button>
                    </div>
                    
                    <!-- Profile Menu -->
                    <div class="relative">
                        <button id="adminProfileBtn" class="flex items-center space-x-2 space-x-reverse text-gray-700 hover:text-purple-600">
                            <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center text-white font-semibold">
                                إ
                            </div>
                            <span class="hidden md:block">المدير العام</span>
                            <span class="text-sm">⌄</span>
                        </button>
                        
                        <!-- Profile Dropdown -->
                        <div id="profileDropdown" class="hidden absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                            <div class="py-2">
                                <div class="px-4 py-2 border-b border-gray-100">
                                    <div class="text-sm font-medium text-gray-900">المدير العام</div>
                                    <div class="text-xs text-gray-500">admin@academic.vet</div>
                                </div>
                                <button id="profileSettings" class="w-full text-right px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-2 space-x-reverse">
                                    <span>⚙️</span>
                                    <span>إعدادات الحساب</span>
                                </button>
                                <button id="changePassword" class="w-full text-right px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center space-x-2 space-x-reverse">
                                    <span>🔑</span>
                                    <span>تغيير كلمة المرور</span>
                                </button>
                                <hr class="my-1">
                                <button id="logoutBtn" class="w-full text-right px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2 space-x-reverse">
                                    <span>🚪</span>
                                    <span>تسجيل الخروج</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Menu Toggle -->
                    <button id="mobileMenuBtn" class="md:hidden p-2 text-gray-600 hover:text-purple-600">
                        <span class="text-xl">☰</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar w-64 bg-white shadow-lg border-l border-gray-200 min-h-screen">
            <nav class="p-4">
                <div class="space-y-2">
                    <button class="nav-item w-full text-right px-4 py-3 rounded-lg bg-purple-100 text-purple-700 font-medium" data-section="dashboard">
                        📊 لوحة التحكم الرئيسية
                    </button>
                    <button class="nav-item w-full text-right px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-section="users">
                        👥 إدارة المستخدمين
                    </button>
                    <button class="nav-item w-full text-right px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-section="content">
                        📝 إدارة المحتوى
                    </button>
                    <button class="nav-item w-full text-right px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-section="activities">
                        📈 تتبع النشاطات
                    </button>
                    <button class="nav-item w-full text-right px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-section="notifications">
                        🔔 إدارة الإشعارات
                    </button>
                    <button class="nav-item w-full text-right px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-section="settings">
                        ⚙️ الإعدادات
                    </button>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="section">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="card-hover bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">إجمالي المستخدمين</p>
                                <p class="text-2xl font-bold text-gray-900">245</p>
                                <p class="text-xs text-green-600">↗️ +12 هذا الأسبوع</p>
                            </div>
                            <div class="text-3xl">👥</div>
                        </div>
                    </div>

                    <div class="card-hover bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">نشط اليوم</p>
                                <p class="text-2xl font-bold text-green-600">42</p>
                                <p class="text-xs text-gray-500">من أصل 245</p>
                            </div>
                            <div class="text-3xl">🟢</div>
                        </div>
                    </div>

                    <div class="card-hover bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">المنشورات</p>
                                <p class="text-2xl font-bold text-blue-600">128</p>
                                <p class="text-xs text-blue-600">↗️ +5 اليوم</p>
                            </div>
                            <div class="text-3xl">📝</div>
                        </div>
                    </div>

                    <div class="card-hover bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600">الإشعارات</p>
                                <p class="text-2xl font-bold text-purple-600">89</p>
                                <p class="text-xs text-purple-600">↗️ +15 اليوم</p>
                            </div>
                            <div class="text-3xl">🔔</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Usage Chart -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">إحصائيات الاستخدام الأسبوعية</h3>
                        <canvas id="usageChart" width="400" height="200"></canvas>
                    </div>

                    <!-- Year Distribution -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">توزيع المستخدمين حسب السنة</h3>
                        <canvas id="yearChart" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">النشاطات الأخيرة</h3>
                    <div class="space-y-3" id="recentActivities">
                        <!-- Activities will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Users Management Section -->
            <div id="users-section" class="section hidden">
                <!-- Year Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold">48</div>
                        <div class="text-sm opacity-90">السنة الأولى</div>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold">52</div>
                        <div class="text-sm opacity-90">السنة الثانية</div>
                    </div>
                    <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold">49</div>
                        <div class="text-sm opacity-90">السنة الثالثة</div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold">51</div>
                        <div class="text-sm opacity-90">السنة الرابعة</div>
                    </div>
                    <div class="bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl p-4 text-center">
                        <div class="text-2xl font-bold">45</div>
                        <div class="text-sm opacity-90">السنة الخامسة</div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">فلترة المستخدمين</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">السنة الدراسية</label>
                            <select id="yearFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">جميع السنوات</option>
                                <option value="1">السنة الأولى</option>
                                <option value="2">السنة الثانية</option>
                                <option value="3">السنة الثالثة</option>
                                <option value="4">السنة الرابعة</option>
                                <option value="5">السنة الخامسة</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">حالة المستخدم</label>
                            <select id="statusFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">جميع الحالات</option>
                                <option value="available">متاح</option>
                                <option value="busy">مشغول</option>
                                <option value="exam">في امتحان</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">البحث</label>
                            <input type="text" id="userSearch" placeholder="البحث بالاسم أو الرقم الجامعي..." 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-bold text-gray-900">قائمة المستخدمين</h3>
                            <button id="addUserBtn" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                ➕ إضافة مستخدم جديد
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">المستخدم</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">السنة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">الحالة</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">آخر نشاط</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">تاريخ التسجيل</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Users will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Content Management Section -->
            <div id="content-section" class="section hidden">
                <!-- Create Post Form -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">إنشاء منشور جديد</h3>
                    
                    <!-- Post Type Selection -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">نوع المنشور</label>
                        <div class="flex space-x-4 space-x-reverse">
                            <button class="post-type-btn active px-4 py-2 bg-purple-600 text-white rounded-lg" data-type="normal">
                                📝 منشور عادي
                            </button>
                            <button class="post-type-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg" data-type="poll">
                                📊 استطلاع رأي
                            </button>
                            <button class="post-type-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-lg" data-type="announcement">
                                📢 إعلان رسمي
                            </button>
                        </div>
                    </div>

                    <!-- Target Audience -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">استهداف السنوات</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" id="targetAll" class="mr-2" checked>
                                    <span>جميع السنوات</span>
                                </label>
                                <div id="yearTargets" class="mr-4 space-y-1 opacity-50">
                                    <label class="flex items-center">
                                        <input type="checkbox" class="year-target mr-2" value="1">
                                        <span>السنة الأولى</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="year-target mr-2" value="2">
                                        <span>السنة الثانية</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="year-target mr-2" value="3">
                                        <span>السنة الثالثة</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="year-target mr-2" value="4">
                                        <span>السنة الرابعة</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="year-target mr-2" value="5">
                                        <span>السنة الخامسة</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">أولوية المنشور</label>
                            <select id="postPriority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="normal">عادي</option>
                                <option value="important">مهم (برتقالي)</option>
                                <option value="urgent">عاجل (أحمر)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Post Content -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">محتوى المنشور</label>
                        <textarea id="postContent" rows="4" placeholder="اكتب محتوى المنشور هنا..." 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 resize-none"></textarea>
                    </div>

                    <!-- Poll Options (Hidden by default) -->
                    <div id="pollOptions" class="mb-4 hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">خيارات الاستطلاع</label>
                        <div class="space-y-2" id="pollOptionsList">
                            <input type="text" placeholder="الخيار الأول" class="poll-option w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <input type="text" placeholder="الخيار الثاني" class="poll-option w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <button type="button" id="addPollOption" class="mt-2 px-3 py-1 text-sm bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
                            ➕ إضافة خيار
                        </button>
                    </div>

                    <!-- Images Upload -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">إضافة صور (اختياري)</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                            <input type="file" id="postImages" multiple accept="image/*" class="hidden">
                            <button type="button" onclick="document.getElementById('postImages').click()" 
                                    class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">
                                📷 اختيار صور متعددة
                            </button>
                            <p class="text-sm text-gray-500 mt-2">يمكنك اختيار عدة صور</p>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-between items-center">
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <label class="flex items-center">
                                <input type="checkbox" id="pinPost" class="mr-2">
                                <span class="text-sm">تثبيت المنشور</span>
                            </label>
                        </div>
                        <div class="flex space-x-2 space-x-reverse">
                            <button type="button" id="saveDraft" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                                💾 حفظ كمسودة
                            </button>
                            <button type="button" id="publishPost" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                🚀 نشر
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Posts List -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">المنشورات المنشورة</h3>
                    <div class="space-y-4" id="publishedPosts">
                        <!-- Posts will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Activities Section -->
            <div id="activities-section" class="section hidden">
                <!-- Activity Filters -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">فلترة النشاطات</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">نوع النشاط</label>
                            <select id="activityTypeFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="">جميع الأنشطة</option>
                                <option value="login">تسجيل دخول</option>
                                <option value="register">تسجيل جديد</option>
                                <option value="first_login">أول دخول</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">التاريخ من</label>
                            <input type="date" id="dateFrom" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">التاريخ إلى</label>
                            <input type="date" id="dateTo" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>
                </div>

                <!-- Activities Table -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-bold text-gray-900">سجل النشاطات المفصل</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">المستخدم</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">نوع العملية</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">التوقيت</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">عنوان IP</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">المتصفح</th>
                                </tr>
                            </thead>
                            <tbody id="activitiesTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Activities will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Notifications Section -->
            <div id="notifications-section" class="section hidden">
                <!-- Send Custom Notification -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">إرسال إشعار مخصص</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">عنوان الإشعار</label>
                            <input type="text" id="notificationTitle" placeholder="عنوان الإشعار" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">محتوى الإشعار</label>
                            <textarea id="notificationContent" rows="3" placeholder="محتوى الإشعار" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 resize-none"></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">نوع الإشعار</label>
                                <select id="notificationType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                    <option value="info">معلومات</option>
                                    <option value="warning">تحذير</option>
                                    <option value="success">نجاح</option>
                                    <option value="error">خطأ</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">المستهدفون</label>
                                <select id="notificationTarget" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                    <option value="all">جميع المستخدمين</option>
                                    <option value="1">السنة الأولى</option>
                                    <option value="2">السنة الثانية</option>
                                    <option value="3">السنة الثالثة</option>
                                    <option value="4">السنة الرابعة</option>
                                    <option value="5">السنة الخامسة</option>
                                </select>
                            </div>
                        </div>
                        <button id="sendNotification" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            📤 إرسال الإشعار
                        </button>
                    </div>
                </div>

                <!-- Notifications History -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">سجل الإشعارات</h3>
                    <div class="space-y-3" id="notificationsHistory">
                        <!-- Notifications will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="section hidden">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-6">إعدادات النظام</h3>
                    
                    <div class="space-y-6">
                        <!-- Academic Year Settings -->
                        <div class="border-b border-gray-200 pb-6">
                            <h4 class="text-md font-semibold text-gray-900 mb-4">إعدادات السنة الأكاديمية</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">السنة الأكاديمية الحالية</label>
                                    <input type="text" value="2024-2025" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">الفصل الحالي</label>
                                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                        <option>الفصل الأول</option>
                                        <option>الفصل الثاني</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Notification Settings -->
                        <div class="border-b border-gray-200 pb-6">
                            <h4 class="text-md font-semibold text-gray-900 mb-4">إعدادات الإشعارات</h4>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span>إشعارات تسجيل المستخدمين الجدد</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span>إشعارات تسجيل الدخول</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span>إشعارات المنشورات الجديدة</span>
                                </label>
                            </div>
                        </div>

                        <!-- Logo Settings -->
                        <div class="border-b border-gray-200 pb-6">
                            <h4 class="text-md font-semibold text-gray-900 mb-4">إعدادات الشعار</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">الشعار الحالي</label>
                                    <div class="flex items-center space-x-4 space-x-reverse">
                                        <div class="w-16 h-16 bg-white rounded-lg border-2 border-gray-200 flex items-center justify-center p-2">
                                            <img id="currentLogo" 
                                                 src="https://drive.google.com/uc?export=view&id=1z3uZjYrJyUJW20pFuxB18rclWWZVtEAP" 
                                                 alt="الشعار الحالي" 
                                                 class="w-full h-full object-contain rounded-lg"
                                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                            <span class="text-purple-600 font-bold text-2xl hidden">🎓</span>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-600">الشعار المعروض حالياً</p>
                                            <p class="text-xs text-gray-500">يظهر في جميع صفحات المنصة</p>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">تحديث الشعار</label>
                                    <div class="space-y-3">
                                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
                                            <input type="file" id="logoUpload" accept="image/*" class="hidden">
                                            <button type="button" onclick="document.getElementById('logoUpload').click()" 
                                                    class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                                                📷 اختيار شعار جديد
                                            </button>
                                            <p class="text-xs text-gray-500 mt-2">PNG, JPG, SVG (الحد الأقصى: 2MB)</p>
                                        </div>
                                        <div class="flex space-x-2 space-x-reverse">
                                            <button id="saveLogo" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                                💾 حفظ الشعار
                                            </button>
                                            <button id="resetLogo" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
                                                🔄 استعادة الافتراضي
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Maintenance -->
                        <div>
                            <h4 class="text-md font-semibold text-gray-900 mb-4">صيانة النظام</h4>
                            <div class="flex space-x-4 space-x-reverse">
                                <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                    🔄 تحديث البيانات
                                </button>
                                <button class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    💾 نسخ احتياطي
                                </button>
                                <button class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">
                                    🧹 تنظيف السجلات
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    </div> <!-- End Dashboard Page -->

    <!-- Admin Notifications Popup -->
    <div id="adminNotificationPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 popup-overlay z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6 slide-in">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-900">إشعارات الإدارة</h3>
                    <button id="closeAdminNotification" class="text-gray-500 hover:text-gray-700">
                        <span class="text-xl">✕</span>
                    </button>
                </div>
                <div id="adminNotificationsList" class="space-y-3 max-h-96 overflow-y-auto">
                    <!-- Admin notifications will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Authentication credentials
        const ADMIN_CREDENTIALS = {
            username: 'AcademicVETnew',
            password: 'AcaDemic_2025_New'
        };

        // Navigation history
        let navigationHistory = [];
        let isLoggedIn = false;

        // Sample Data
        const usersData = [
            { id: 1, name: "أحمد محمد علي", studentId: "VET2024001", year: 1, status: "available", lastActive: "منذ 5 دقائق", joinDate: "2024-01-15", avatar: "أ" },
            { id: 2, name: "فاطمة أحمد", studentId: "VET2024002", year: 2, status: "busy", lastActive: "منذ ساعة", joinDate: "2024-01-16", avatar: "ف" },
            { id: 3, name: "محمد حسن", studentId: "VET2024003", year: 3, status: "exam", lastActive: "منذ 3 ساعات", joinDate: "2024-01-17", avatar: "م" },
            { id: 4, name: "سارة محمود", studentId: "VET2024004", year: 1, status: "available", lastActive: "منذ 10 دقائق", joinDate: "2024-01-18", avatar: "س" },
            { id: 5, name: "علي أحمد", studentId: "VET2024005", year: 4, status: "available", lastActive: "منذ 2 ساعة", joinDate: "2024-01-19", avatar: "ع" }
        ];

        const activitiesData = [
            { user: "أحمد محمد علي", type: "login", timestamp: "2024-01-20 14:30:25", ip: "192.168.1.100", browser: "Chrome 120.0" },
            { user: "فاطمة أحمد", type: "register", timestamp: "2024-01-20 13:45:12", ip: "192.168.1.101", browser: "Firefox 121.0" },
            { user: "محمد حسن", type: "first_login", timestamp: "2024-01-20 12:15:33", ip: "192.168.1.102", browser: "Safari 17.0" },
            { user: "سارة محمود", type: "login", timestamp: "2024-01-20 11:20:45", ip: "192.168.1.103", browser: "Chrome 120.0" },
            { user: "علي أحمد", type: "login", timestamp: "2024-01-20 10:35:18", ip: "192.168.1.104", browser: "Edge 120.0" }
        ];

        const adminNotifications = [
            { id: 1, title: "مستخدم جديد", content: "انضم أحمد محمد إلى المنصة", time: "منذ 5 دقائق", type: "user", read: false },
            { id: 2, title: "تسجيل دخول", content: "فاطمة أحمد سجلت دخولها", time: "منذ 15 دقيقة", type: "login", read: false },
            { id: 3, title: "منشور جديد", content: "تم إنشاء منشور جديد بواسطة د. محمد", time: "منذ 30 دقيقة", type: "post", read: true },
            { id: 4, title: "نشاط مشبوه", content: "محاولات دخول متعددة من IP واحد", time: "منذ ساعة", type: "security", read: false },
            { id: 5, title: "تحديث النظام", content: "تم تحديث قاعدة البيانات بنجاح", time: "منذ ساعتين", type: "system", read: true }
        ];

        const publishedPostsData = [
            {
                id: 1,
                type: "announcement",
                priority: "urgent",
                title: "إعلان مهم: تأجيل الامتحانات",
                content: "تم تأجيل جميع امتحانات الأسبوع القادم بسبب الظروف الجوية",
                target: "all",
                timestamp: "منذ ساعة",
                pinned: true,
                likes: 45,
                comments: 12
            },
            {
                id: 2,
                type: "poll",
                priority: "normal",
                title: "استطلاع: أفضل وقت للمحاضرات الإضافية",
                content: "ما هو أفضل وقت لعقد المحاضرات الإضافية؟",
                target: "1,2,3",
                timestamp: "منذ 3 ساعات",
                pinned: false,
                poll: {
                    options: [
                        { text: "صباحاً (8-10)", votes: 25 },
                        { text: "ظهراً (12-2)", votes: 38 },
                        { text: "مساءً (4-6)", votes: 15 }
                    ]
                }
            }
        ];

        // Current state
        let currentSection = 'dashboard';
        let currentPostType = 'normal';
        let selectedLogoFile = null;
        let currentLogoUrl = 'https://drive.google.com/uc?export=view&id=1z3uZjYrJyUJW20pFuxB18rclWWZVtEAP';

        // Initialize the application
        function init() {
            checkLoginStatus();
            setupEventListeners();
            if (isLoggedIn) {
                showDashboard();
                loadDashboard();
                loadUsers();
                loadActivities();
                loadPublishedPosts();
                loadAdminNotifications();
                initCharts();
            }
        }

        // Check if user is already logged in
        function checkLoginStatus() {
            const savedLogin = localStorage.getItem('adminLoggedIn');
            const savedTime = localStorage.getItem('adminLoginTime');
            
            if (savedLogin === 'true' && savedTime) {
                const loginTime = new Date(savedTime);
                const now = new Date();
                const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
                
                // Auto logout after 8 hours
                if (hoursDiff < 8) {
                    isLoggedIn = true;
                } else {
                    localStorage.removeItem('adminLoggedIn');
                    localStorage.removeItem('adminLoginTime');
                }
            }
        }

        // Show dashboard
        function showDashboard() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
        }

        // Show login page
        function showLoginPage() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('dashboardPage').classList.add('hidden');
            
            // Clear form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').classList.add('hidden');
        }

        // Handle login
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // Show loading state
            const loginBtn = document.getElementById('loginBtn');
            const loginBtnText = document.getElementById('loginBtnText');
            const loginSpinner = document.getElementById('loginSpinner');
            const loginError = document.getElementById('loginError');
            
            loginBtn.disabled = true;
            loginBtnText.classList.add('hidden');
            loginSpinner.classList.remove('hidden');
            loginError.classList.add('hidden');
            
            // Simulate authentication delay
            setTimeout(() => {
                if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                    // Successful login
                    isLoggedIn = true;
                    
                    // Save login state
                    if (rememberMe) {
                        localStorage.setItem('adminLoggedIn', 'true');
                        localStorage.setItem('adminLoginTime', new Date().toISOString());
                    } else {
                        sessionStorage.setItem('adminLoggedIn', 'true');
                    }
                    
                    // Show success message briefly
                    loginBtnText.textContent = '✅ تم تسجيل الدخول بنجاح!';
                    loginBtnText.classList.remove('hidden');
                    loginSpinner.classList.add('hidden');
                    
                    setTimeout(() => {
                        showDashboard();
                        loadDashboard();
                        loadUsers();
                        loadActivities();
                        loadPublishedPosts();
                        loadAdminNotifications();
                        initCharts();
                        
                        // Reset button
                        loginBtn.disabled = false;
                        loginBtnText.textContent = '🔑 تسجيل الدخول';
                    }, 1000);
                    
                } else {
                    // Failed login
                    loginError.classList.remove('hidden');
                    loginBtn.disabled = false;
                    loginBtnText.classList.remove('hidden');
                    loginSpinner.classList.add('hidden');
                    
                    // Shake animation for error
                    loginError.style.animation = 'shake 0.5s ease-in-out';
                    setTimeout(() => {
                        loginError.style.animation = '';
                    }, 500);
                }
            }, 1500);
        }

        // Handle logout
        function handleLogout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                isLoggedIn = false;
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminLoginTime');
                sessionStorage.removeItem('adminLoggedIn');
                
                // Clear navigation history
                navigationHistory = [];
                
                showLoginPage();
            }
        }

        // Navigation functions
        function addToHistory(section) {
            if (navigationHistory.length === 0 || navigationHistory[navigationHistory.length - 1] !== section) {
                navigationHistory.push(section);
                updateBackButton();
            }
        }

        function goBack() {
            if (navigationHistory.length > 1) {
                navigationHistory.pop(); // Remove current section
                const previousSection = navigationHistory[navigationHistory.length - 1];
                switchSection(previousSection, false); // Don't add to history
            }
        }

        function updateBackButton() {
            const backBtn = document.getElementById('backBtn');
            if (navigationHistory.length > 1) {
                backBtn.classList.remove('hidden');
            } else {
                backBtn.classList.add('hidden');
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Toggle password visibility
            document.getElementById('togglePassword').addEventListener('click', function() {
                const passwordInput = document.getElementById('password');
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                this.innerHTML = type === 'password' ? '<span class="text-gray-400 text-sm hover:text-gray-600 cursor-pointer">👁️</span>' : '<span class="text-gray-400 text-sm hover:text-gray-600 cursor-pointer">🙈</span>';
            });

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    switchSection(this.dataset.section);
                });
            });

            // Back button
            document.getElementById('backBtn').addEventListener('click', goBack);

            // Profile dropdown
            document.getElementById('adminProfileBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                const dropdown = document.getElementById('profileDropdown');
                dropdown.classList.toggle('hidden');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                document.getElementById('profileDropdown').classList.add('hidden');
            });

            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            // Profile settings (placeholder)
            document.getElementById('profileSettings').addEventListener('click', function() {
                alert('إعدادات الحساب - قريباً!');
                document.getElementById('profileDropdown').classList.add('hidden');
            });

            // Change password (placeholder)
            document.getElementById('changePassword').addEventListener('click', function() {
                const newPassword = prompt('أدخل كلمة المرور الجديدة:');
                if (newPassword && newPassword.length >= 6) {
                    alert('تم تغيير كلمة المرور بنجاح! 🔑');
                } else if (newPassword) {
                    alert('كلمة المرور يجب أن تكون 6 أحرف على الأقل');
                }
                document.getElementById('profileDropdown').classList.add('hidden');
            });

            // Mobile menu toggle
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('sidebar-collapsed');
            });

            // Post type selection
            document.querySelectorAll('.post-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.post-type-btn').forEach(b => {
                        b.classList.remove('active', 'bg-purple-600', 'text-white');
                        b.classList.add('bg-gray-200', 'text-gray-700');
                    });
                    this.classList.add('active', 'bg-purple-600', 'text-white');
                    this.classList.remove('bg-gray-200', 'text-gray-700');
                    currentPostType = this.dataset.type;
                    togglePostOptions();
                });
            });

            // Target all checkbox
            document.getElementById('targetAll').addEventListener('change', function() {
                const yearTargets = document.getElementById('yearTargets');
                const yearCheckboxes = document.querySelectorAll('.year-target');
                
                if (this.checked) {
                    yearTargets.classList.add('opacity-50');
                    yearCheckboxes.forEach(cb => cb.disabled = true);
                } else {
                    yearTargets.classList.remove('opacity-50');
                    yearCheckboxes.forEach(cb => cb.disabled = false);
                }
            });

            // Add poll option
            document.getElementById('addPollOption').addEventListener('click', function() {
                const optionsList = document.getElementById('pollOptionsList');
                const optionCount = optionsList.children.length + 1;
                const newOption = document.createElement('input');
                newOption.type = 'text';
                newOption.placeholder = `الخيار ${optionCount}`;
                newOption.className = 'poll-option w-full px-3 py-2 border border-gray-300 rounded-lg';
                optionsList.appendChild(newOption);
            });

            // Publish post
            document.getElementById('publishPost').addEventListener('click', publishPost);

            // Admin notifications
            document.getElementById('adminNotificationBtn').addEventListener('click', function() {
                document.getElementById('adminNotificationPopup').classList.remove('hidden');
            });

            document.getElementById('closeAdminNotification').addEventListener('click', function() {
                document.getElementById('adminNotificationPopup').classList.add('hidden');
            });

            // Send custom notification
            document.getElementById('sendNotification').addEventListener('click', sendCustomNotification);

            // User filters
            document.getElementById('yearFilter').addEventListener('change', filterUsers);
            document.getElementById('statusFilter').addEventListener('change', filterUsers);
            document.getElementById('userSearch').addEventListener('input', filterUsers);

            // Activity filters
            document.getElementById('activityTypeFilter').addEventListener('change', filterActivities);
            document.getElementById('dateFrom').addEventListener('change', filterActivities);
            document.getElementById('dateTo').addEventListener('change', filterActivities);

            // Logo management
            document.getElementById('logoUpload').addEventListener('change', handleLogoUpload);
            document.getElementById('saveLogo').addEventListener('click', saveLogo);
            document.getElementById('resetLogo').addEventListener('click', resetLogo);
        }

        // Switch between sections
        function switchSection(sectionName, addToHistoryFlag = true) {
            // Add to navigation history
            if (addToHistoryFlag) {
                addToHistory(sectionName);
            }

            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-purple-100', 'text-purple-700', 'font-medium');
                item.classList.add('text-gray-700');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('bg-purple-100', 'text-purple-700', 'font-medium');

            // Update content
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(`${sectionName}-section`).classList.remove('hidden');

            currentSection = sectionName;

            // Close mobile menu
            if (window.innerWidth < 768) {
                document.getElementById('sidebar').classList.add('sidebar-collapsed');
            }

            // Close profile dropdown
            document.getElementById('profileDropdown').classList.add('hidden');
        }

        // Toggle post options based on type
        function togglePostOptions() {
            const pollOptions = document.getElementById('pollOptions');
            
            if (currentPostType === 'poll') {
                pollOptions.classList.remove('hidden');
            } else {
                pollOptions.classList.add('hidden');
            }
        }

        // Load dashboard data
        function loadDashboard() {
            const recentActivities = document.getElementById('recentActivities');
            recentActivities.innerHTML = '';

            const recentData = activitiesData.slice(0, 5);
            recentData.forEach(activity => {
                const activityDiv = document.createElement('div');
                activityDiv.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';

                const typeIcon = {
                    'login': '🔑',
                    'register': '👤',
                    'first_login': '🎉'
                };

                const typeText = {
                    'login': 'تسجيل دخول',
                    'register': 'تسجيل جديد',
                    'first_login': 'أول دخول'
                };

                activityDiv.innerHTML = `
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <span class="text-2xl">${typeIcon[activity.type]}</span>
                        <div>
                            <div class="font-medium text-gray-900">${activity.user}</div>
                            <div class="text-sm text-gray-500">${typeText[activity.type]} • ${activity.timestamp}</div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-400">${activity.ip}</div>
                `;

                recentActivities.appendChild(activityDiv);
            });
        }

        // Load users table
        function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            usersData.forEach(user => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';

                const statusColors = {
                    'available': 'bg-green-100 text-green-800',
                    'busy': 'bg-yellow-100 text-yellow-800',
                    'exam': 'bg-red-100 text-red-800'
                };

                const statusText = {
                    'available': 'متاح',
                    'busy': 'مشغول',
                    'exam': 'في امتحان'
                };

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                                ${user.avatar}
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-900">${user.name}</div>
                                <div class="text-sm text-gray-500">${user.studentId}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
                            السنة ${user.year}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${statusColors[user.status]}">
                            ${statusText[user.status]}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${user.lastActive}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${user.joinDate}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2 space-x-reverse">
                            <button onclick="editUser(${user.id})" class="text-purple-600 hover:text-purple-900">✏️</button>
                            <button onclick="messageUser(${user.id})" class="text-blue-600 hover:text-blue-900">💬</button>
                            <button onclick="viewUserDetails(${user.id})" class="text-green-600 hover:text-green-900">👁️</button>
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });
        }

        // Load activities table
        function loadActivities() {
            const tbody = document.getElementById('activitiesTableBody');
            tbody.innerHTML = '';

            activitiesData.forEach(activity => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';

                const typeColors = {
                    'login': 'bg-green-100 text-green-800',
                    'register': 'bg-blue-100 text-blue-800',
                    'first_login': 'bg-purple-100 text-purple-800'
                };

                const typeText = {
                    'login': 'تسجيل دخول',
                    'register': 'تسجيل جديد',
                    'first_login': 'أول دخول'
                };

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        ${activity.user}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${typeColors[activity.type]}">
                            ${typeText[activity.type]}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${activity.timestamp}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${activity.ip}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${activity.browser}
                    </td>
                `;

                tbody.appendChild(row);
            });
        }

        // Load published posts
        function loadPublishedPosts() {
            const container = document.getElementById('publishedPosts');
            container.innerHTML = '';

            publishedPostsData.forEach(post => {
                const postDiv = document.createElement('div');
                postDiv.className = `p-4 border rounded-lg ${post.priority === 'urgent' ? 'priority-urgent' : post.priority === 'important' ? 'priority-important' : 'priority-normal'}`;

                const typeIcon = {
                    'normal': '📝',
                    'poll': '📊',
                    'announcement': '📢'
                };

                const priorityBadge = {
                    'normal': '<span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">عادي</span>',
                    'important': '<span class="px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded-full">مهم</span>',
                    'urgent': '<span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded-full">عاجل</span>'
                };

                postDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <span class="text-lg">${typeIcon[post.type]}</span>
                            <h4 class="font-semibold text-gray-900">${post.title || 'منشور'}</h4>
                            ${post.pinned ? '<span class="text-yellow-500">📌</span>' : ''}
                        </div>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            ${priorityBadge[post.priority]}
                            <span class="text-sm text-gray-500">${post.timestamp}</span>
                        </div>
                    </div>
                    <p class="text-gray-700 mb-3">${post.content}</p>
                    <div class="flex justify-between items-center text-sm text-gray-500">
                        <div class="flex space-x-4 space-x-reverse">
                            <span>👍 ${post.likes || 0}</span>
                            <span>💬 ${post.comments || 0}</span>
                            <span>🎯 ${post.target === 'all' ? 'جميع السنوات' : `السنوات: ${post.target}`}</span>
                        </div>
                        <div class="flex space-x-2 space-x-reverse">
                            <button onclick="editPost(${post.id})" class="text-blue-600 hover:text-blue-800">✏️ تعديل</button>
                            <button onclick="deletePost(${post.id})" class="text-red-600 hover:text-red-800">🗑️ حذف</button>
                        </div>
                    </div>
                `;

                container.appendChild(postDiv);
            });
        }

        // Load admin notifications
        function loadAdminNotifications() {
            const list = document.getElementById('adminNotificationsList');
            list.innerHTML = '';

            adminNotifications.forEach(notification => {
                const notifDiv = document.createElement('div');
                notifDiv.className = `p-3 rounded-lg border-r-4 ${notification.read ? 'bg-gray-50 border-gray-300' : 'bg-blue-50 border-blue-500'}`;

                const typeIcon = {
                    'user': '👤',
                    'login': '🔑',
                    'post': '📝',
                    'security': '🔒',
                    'system': '⚙️'
                };

                notifDiv.innerHTML = `
                    <div class="flex items-start space-x-3 space-x-reverse">
                        <span class="text-lg">${typeIcon[notification.type]}</span>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900 text-sm">${notification.title}</h4>
                            <p class="text-gray-600 text-xs mt-1">${notification.content}</p>
                            <p class="text-gray-500 text-xs mt-1">${notification.time}</p>
                        </div>
                        ${!notification.read ? '<div class="w-2 h-2 bg-blue-500 rounded-full"></div>' : ''}
                    </div>
                `;

                list.appendChild(notifDiv);
            });
        }

        // Initialize charts
        function initCharts() {
            // Usage Chart
            const usageCtx = document.getElementById('usageChart').getContext('2d');
            new Chart(usageCtx, {
                type: 'line',
                data: {
                    labels: ['السبت', 'الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة'],
                    datasets: [{
                        label: 'المستخدمين النشطين',
                        data: [65, 78, 90, 81, 56, 45, 30],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Year Distribution Chart
            const yearCtx = document.getElementById('yearChart').getContext('2d');
            new Chart(yearCtx, {
                type: 'doughnut',
                data: {
                    labels: ['السنة الأولى', 'السنة الثانية', 'السنة الثالثة', 'السنة الرابعة', 'السنة الخامسة'],
                    datasets: [{
                        data: [48, 52, 49, 51, 45],
                        backgroundColor: [
                            '#3b82f6',
                            '#10b981',
                            '#f59e0b',
                            '#8b5cf6',
                            '#ef4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Publish post
        function publishPost() {
            const content = document.getElementById('postContent').value.trim();
            if (!content) {
                alert('يرجى إدخال محتوى المنشور');
                return;
            }

            const newPost = {
                id: publishedPostsData.length + 1,
                type: currentPostType,
                priority: document.getElementById('postPriority').value,
                title: currentPostType === 'announcement' ? 'إعلان جديد' : '',
                content: content,
                target: document.getElementById('targetAll').checked ? 'all' : getSelectedYears(),
                timestamp: 'الآن',
                pinned: document.getElementById('pinPost').checked,
                likes: 0,
                comments: 0
            };

            if (currentPostType === 'poll') {
                const pollOptions = Array.from(document.querySelectorAll('.poll-option'))
                    .map(input => input.value.trim())
                    .filter(value => value);
                
                if (pollOptions.length < 2) {
                    alert('يجب إضافة خيارين على الأقل للاستطلاع');
                    return;
                }

                newPost.poll = {
                    options: pollOptions.map(option => ({ text: option, votes: 0 }))
                };
            }

            publishedPostsData.unshift(newPost);
            loadPublishedPosts();

            // Clear form
            document.getElementById('postContent').value = '';
            document.getElementById('pinPost').checked = false;
            document.querySelectorAll('.poll-option').forEach(input => input.value = '');

            alert('تم نشر المنشور بنجاح! 🎉');
        }

        // Get selected years
        function getSelectedYears() {
            return Array.from(document.querySelectorAll('.year-target:checked'))
                .map(cb => cb.value)
                .join(',');
        }

        // Send custom notification
        function sendCustomNotification() {
            const title = document.getElementById('notificationTitle').value.trim();
            const content = document.getElementById('notificationContent').value.trim();
            
            if (!title || !content) {
                alert('يرجى إدخال عنوان ومحتوى الإشعار');
                return;
            }

            const notification = {
                id: Date.now(),
                title: title,
                content: content,
                type: document.getElementById('notificationType').value,
                target: document.getElementById('notificationTarget').value,
                timestamp: 'الآن',
                sent: true
            };

            // Clear form
            document.getElementById('notificationTitle').value = '';
            document.getElementById('notificationContent').value = '';

            alert('تم إرسال الإشعار بنجاح! 📤');
        }

        // Filter functions
        function filterUsers() {
            const yearFilter = document.getElementById('yearFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();

            const rows = document.querySelectorAll('#usersTableBody tr');
            rows.forEach(row => {
                const userData = usersData.find(user => 
                    row.textContent.includes(user.name)
                );

                if (!userData) return;

                const matchesYear = !yearFilter || userData.year.toString() === yearFilter;
                const matchesStatus = !statusFilter || userData.status === statusFilter;
                const matchesSearch = !searchTerm || 
                    userData.name.toLowerCase().includes(searchTerm) ||
                    userData.studentId.toLowerCase().includes(searchTerm);

                if (matchesYear && matchesStatus && matchesSearch) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function filterActivities() {
            const typeFilter = document.getElementById('activityTypeFilter').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;

            const rows = document.querySelectorAll('#activitiesTableBody tr');
            rows.forEach(row => {
                const activityData = activitiesData.find(activity => 
                    row.textContent.includes(activity.user)
                );

                if (!activityData) return;

                const matchesType = !typeFilter || activityData.type === typeFilter;
                // Date filtering would need proper date parsing in a real application
                const matchesDate = true; // Simplified for demo

                if (matchesType && matchesDate) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // User management functions
        function editUser(userId) {
            alert(`تعديل بيانات المستخدم رقم: ${userId}`);
        }

        function messageUser(userId) {
            const user = usersData.find(u => u.id === userId);
            const message = prompt(`إرسال رسالة إلى ${user.name}:`);
            if (message) {
                alert('تم إرسال الرسالة بنجاح! 📤');
            }
        }

        function viewUserDetails(userId) {
            const user = usersData.find(u => u.id === userId);
            alert(`تفاصيل المستخدم:\nالاسم: ${user.name}\nالرقم الجامعي: ${user.studentId}\nالسنة: ${user.year}\nالحالة: ${user.status}`);
        }

        // Post management functions
        function editPost(postId) {
            alert(`تعديل المنشور رقم: ${postId}`);
        }

        function deletePost(postId) {
            if (confirm('هل أنت متأكد من حذف هذا المنشور؟')) {
                const index = publishedPostsData.findIndex(p => p.id === postId);
                if (index > -1) {
                    publishedPostsData.splice(index, 1);
                    loadPublishedPosts();
                    alert('تم حذف المنشور بنجاح! 🗑️');
                }
            }
        }

        // Logo management functions
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file type
            const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/svg+xml'];
            if (!allowedTypes.includes(file.type)) {
                alert('نوع الملف غير مدعوم. يرجى اختيار PNG أو JPG أو SVG');
                return;
            }

            // Validate file size (2MB max)
            if (file.size > 2 * 1024 * 1024) {
                alert('حجم الملف كبير جداً. الحد الأقصى 2 ميجابايت');
                return;
            }

            selectedLogoFile = file;
            
            // Preview the selected logo
            const reader = new FileReader();
            reader.onload = function(e) {
                const currentLogo = document.getElementById('currentLogo');
                currentLogo.src = e.target.result;
                currentLogo.style.display = 'block';
                currentLogo.nextElementSibling.style.display = 'none';
                
                // Enable save button
                document.getElementById('saveLogo').disabled = false;
            };
            reader.readAsDataURL(file);
        }

        function saveLogo() {
            if (!selectedLogoFile) {
                alert('لم يتم اختيار شعار جديد');
                return;
            }

            // In a real application, this would upload to server
            // For demo purposes, we'll use the file reader result
            const reader = new FileReader();
            reader.onload = function(e) {
                currentLogoUrl = e.target.result;
                updateAllLogos(currentLogoUrl);
                
                // Save to localStorage for persistence
                localStorage.setItem('customLogo', currentLogoUrl);
                
                alert('تم حفظ الشعار الجديد بنجاح! 🎉');
                document.getElementById('saveLogo').disabled = true;
                selectedLogoFile = null;
            };
            reader.readAsDataURL(selectedLogoFile);
        }

        function resetLogo() {
            if (confirm('هل أنت متأكد من استعادة الشعار الافتراضي؟')) {
                const defaultLogo = 'https://drive.google.com/uc?export=view&id=1z3uZjYrJyUJW20pFuxB18rclWWZVtEAP';
                currentLogoUrl = defaultLogo;
                updateAllLogos(defaultLogo);
                
                // Remove from localStorage
                localStorage.removeItem('customLogo');
                
                // Reset file input
                document.getElementById('logoUpload').value = '';
                document.getElementById('saveLogo').disabled = true;
                selectedLogoFile = null;
                
                alert('تم استعادة الشعار الافتراضي بنجاح! ✅');
            }
        }

        function updateAllLogos(logoUrl) {
            // Update all logo instances in the page
            const logoElements = document.querySelectorAll('img[alt*="شعار"], img[alt*="الشعار"]');
            logoElements.forEach(img => {
                img.src = logoUrl;
                img.style.display = 'block';
                const fallback = img.nextElementSibling;
                if (fallback && fallback.tagName === 'SPAN') {
                    fallback.style.display = 'none';
                }
            });
        }

        function loadSavedLogo() {
            const savedLogo = localStorage.getItem('customLogo');
            if (savedLogo) {
                currentLogoUrl = savedLogo;
                updateAllLogos(savedLogo);
            }
        }

        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            init();
            loadSavedLogo();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'977f40dba74632ae',t:'MTc1NjY3MTg4Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
